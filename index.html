<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Birthday Wish Generator</title>

<style>
@font-face {
    font-family: "MyFont";
    src: url("fonts/custom.ttf");
}

body {
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    text-align:center;
}

textarea {
    width:300px;
    height:120px;
    padding:10px;
}

button {
    padding:8px 16px;
    margin:6px;
    cursor:pointer;
}

.row {
    margin:10px auto;
    width:420px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

#cards {
    margin-top:30px;
}

/* ================= CARD ================= */
.card {
    position:relative;
    width:800px;
    height:1000px;
    margin:30px auto;
    background:url("template.png") no-repeat center/cover;
}

/* ===== PHOTO HOLDER (NO CSS CIRCLE) ===== */
.photo {
    position:absolute;
    top:224px;
    left:226px;
    width:340px;
    height:340px;
}

.photo img {
    width:100%;
    height:100%;
    display:block;
}

/* ===== NAME ===== */
.name {
    position:absolute;
    top:602px;
    left:180px;
    width:560px;
    height:70px;
    display:flex;
    align-items:center;
    font-family:"MyFont";
    font-size:48px;
    font-weight:bold;
    color:red;
    white-space:nowrap;
}
</style>
</head>

<body>

<h3>Enter Names (one per line)</h3>
<textarea id="names"></textarea><br>
<button onclick="nextStep()">Next</button>

<div id="uploadArea"></div>

<button onclick="generateCards()">Generate</button>

<div id="cards"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
let users = [];

/* ===== Title Case ===== */
function toTitleCase(text) {
    return text.toLowerCase().split(" ").filter(Boolean)
        .map(w => w[0].toUpperCase() + w.slice(1)).join(" ");
}

/* ===== REAL CIRCULAR IMAGE (NO SQUEEZE) ===== */
function makeCircularImage(file, callback) {
    const img = new Image();
    const reader = new FileReader();

    reader.onload = e => {
        img.onload = () => {
            const size = Math.min(img.width, img.height);
            const canvas = document.createElement("canvas");
            canvas.width = size;
            canvas.height = size;

            const ctx = canvas.getContext("2d");
            ctx.beginPath();
            ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();

            ctx.drawImage(
                img,
                (img.width - size) / 2,
                (img.height - size) / 2,
                size,
                size,
                0,
                0,
                size,
                size
            );

            callback(canvas.toDataURL("image/png"));
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

/* ===== STEP 1: CREATE UPLOAD ROWS ===== */
function nextStep(){
    const input = document.getElementById("names").value.trim();
    if(!input) return alert("Enter names");

    users = input.split("\n").filter(Boolean).map(name => ({
        name: toTitleCase(name),
        photo: null
    }));

    const area = document.getElementById("uploadArea");
    area.innerHTML = "<h3>Upload Photos</h3>";

    users.forEach((u, i) => {
        const div = document.createElement("div");
        div.className = "row";
        div.innerHTML = `
            <span>${u.name}</span>
            <input type="file" accept="image/*"
                onchange="users[${i}].photo = event.target.files[0]">
        `;
        area.appendChild(div);
    });
}

/* ===== STEP 2: GENERATE CARDS ===== */
function generateCards(){
    const container = document.getElementById("cards");
    container.innerHTML = "";

    for(const u of users){
        if(!u.photo){
            alert("Upload all photos");
            return;
        }
    }

    users.forEach(u => {
        makeCircularImage(u.photo, (circleImg) => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <div class="photo">
                    <img src="${circleImg}">
                </div>
                <div class="name">${u.name}</div>
                <button onclick="copyCard(this)"
                  style="position:absolute;top:-40px;left:50%;transform:translateX(-50%)">
                  Copy
                </button>
            `;
            container.appendChild(card);
        });
    });
}

/* ===== STEP 3: COPY – PERFECT PNG ===== */
function copyCard(btn){
    const card = btn.parentElement;
    const scale = window.devicePixelRatio || 1;

    html2canvas(card, {
        backgroundColor: null,
        scale: scale,
        width: card.offsetWidth,
        height: card.offsetHeight,
        useCORS: true
    }).then(canvas => {
        canvas.toBlob(blob => {
            navigator.clipboard.write([
                new ClipboardItem({ "image/png": blob })
            ]);
            alert("Perfect PNG copied ✅");
        });
    });
}
</script>

</body>
</html>


